(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23261,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(17927);function l(){let[e,l]=(0,a.useState)(null),[r,i]=(0,a.useState)(!1),[n,d]=(0,a.useState)([]),[c,o]=(0,a.useState)(!1),[m,u]=(0,a.useState)(null),[h,x]=(0,a.useState)(""),[p,j]=(0,a.useState)("evaluator");async function b(){u(null),o(!0);try{let{data:e}=await t.supabase.auth.getSession(),s=e.session?.access_token;if(!s){i(!1),d([]);return}let a=await fetch("/api/admin/eval-admins",{headers:{Authorization:`Bearer ${s}`}}),l=await a.json();if(!a.ok){i(!1),d([]),u(l?.message||"无权限或请求失败");return}i(!0),d(l.items||[])}catch(e){u(e?.message||"请求失败")}finally{o(!1)}}async function f(){u(null),o(!0);try{let{data:e}=await t.supabase.auth.getSession(),s=e.session?.access_token;if(!s)throw Error("请先登录");let a=await fetch("/api/admin/eval-admins",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({user_id:h.trim(),role:p})}),l=await a.json();if(!a.ok)throw Error(l?.message||"操作失败");x(""),await b()}catch(e){u(e?.message||"操作失败")}finally{o(!1)}}async function N(e){if(confirm(`确认移除该评测权限？
${e}`)){u(null),o(!0);try{let{data:s}=await t.supabase.auth.getSession(),a=s.session?.access_token;if(!a)throw Error("请先登录");let l=await fetch("/api/admin/eval-admins",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({user_id:e})}),r=await l.json();if(!l.ok)throw Error(r?.message||"操作失败");await b()}catch(e){u(e?.message||"操作失败")}finally{o(!1)}}}return(0,a.useEffect)(()=>{t.supabase.auth.getSession().then(({data:e})=>l(e.session?.user??null));let{data:e}=t.supabase.auth.onAuthStateChange((e,s)=>l(s?.user??null));return()=>e.subscription.unsubscribe()},[]),(0,a.useEffect)(()=>{b()},[e?.id]),(0,s.jsxs)("div",{className:"min-h-screen p-6 max-w-3xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"评测后台 · 管理员"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["仅 ",(0,s.jsx)("code",{children:"eval_admins.role=admin"})," 可管理评测白名单。普通用户不可见。"]}),(0,s.jsx)("div",{className:"mt-3 text-sm",children:(0,s.jsx)("a",{className:"underline",href:"/admin/eval",children:"前往评测执行台（上传数据集 / 跑实验）"})}),!e&&(0,s.jsx)("div",{className:"mt-4 p-3 border rounded bg-gray-50 text-sm",children:"你尚未登录。请先在首页登录后再访问此页面。"}),m&&(0,s.jsx)("div",{className:"mt-4 p-3 border rounded bg-red-50 text-sm text-red-700",children:m}),e&&!r&&!c&&(0,s.jsx)("div",{className:"mt-4 p-3 border rounded bg-yellow-50 text-sm text-yellow-800",children:"你不是管理员，无法管理评测权限。"}),e&&r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mt-6 p-4 border rounded",children:[(0,s.jsx)("div",{className:"font-medium mb-3",children:"新增 / 更新评测权限"}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("label",{className:"text-sm",children:["user_id（UUID）",(0,s.jsx)("input",{className:"mt-1 w-full border rounded px-3 py-2",value:h,onChange:e=>x(e.target.value),placeholder:"例如：2c0f...-....-...."})]}),(0,s.jsxs)("label",{className:"text-sm",children:["role",(0,s.jsxs)("select",{className:"mt-1 w-full border rounded px-3 py-2",value:p,onChange:e=>j(e.target.value),children:[(0,s.jsx)("option",{value:"evaluator",children:"evaluator（可跑实验/维护数据集）"}),(0,s.jsx)("option",{value:"admin",children:"admin（额外拥有删除/管理权限）"})]})]}),(0,s.jsx)("button",{className:"mt-2 border rounded px-3 py-2 bg-black text-white disabled:opacity-50",onClick:f,disabled:c||!h.trim(),children:"保存"})]})]}),(0,s.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"font-medium",children:"当前白名单"}),(0,s.jsx)("button",{className:"border rounded px-3 py-2 text-sm",onClick:b,disabled:c,children:"刷新"})]}),(0,s.jsx)("div",{className:"mt-3 border rounded overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left p-2",children:"user_id"}),(0,s.jsx)("th",{className:"text-left p-2",children:"role"}),(0,s.jsx)("th",{className:"text-left p-2",children:"created_at"}),(0,s.jsx)("th",{className:"p-2"})]})}),(0,s.jsxs)("tbody",{children:[0===n.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"p-2 text-gray-600",colSpan:4,children:"暂无数据"})}),n.map(e=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-2 font-mono",children:e.user_id}),(0,s.jsx)("td",{className:"p-2",children:e.role}),(0,s.jsx)("td",{className:"p-2",children:new Date(e.created_at).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right",children:(0,s.jsx)("button",{className:"border rounded px-2 py-1",onClick:()=>N(e.user_id),disabled:c,children:"移除"})})]},e.user_id))]})]})})]})]})}e.s(["default",()=>l])}]);