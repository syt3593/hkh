module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},97877,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].React},19556,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(78560);function e(){let[a,e]=(0,c.useState)(null),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)("food-test"),[x,y]=(0,c.useState)("gemini-3-pro-preview"),[z,A]=(0,c.useState)("v1"),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)([]);async function F(){let{data:a}=await d.supabase.auth.getSession();return a.session?.access_token||""}async function G(){i(null),k(!0);try{let a=await F();if(!a)throw Error("请先登录");let b=await fetch("/api/admin/eval-suites",{headers:{Authorization:`Bearer ${a}`}}),c=await b.json();if(!b.ok)throw Error(c?.message||"无权限或请求失败");g(!0),m(c.items||[]),!n&&(c.items||[]).length&&o(c.items[0].id)}catch(a){g(!1),m([]),i(a?.message||"请求失败")}finally{k(!1)}}async function H(){i(null),k(!0);try{let a=await F();if(!a)throw Error("请先登录");let b=await fetch("/api/admin/eval-suites",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({name:p.trim(),description:r.trim()})}),c=await b.json();if(!b.ok)throw Error(c?.message||"创建失败");q(""),s(""),await G()}catch(a){i(a?.message||"创建失败")}finally{k(!1)}}async function I(){i(null),k(!0);try{if(!n)throw Error("请先选择数据集");if(!t||0===t.length)throw Error("请选择图片");let a=await F();if(!a)throw Error("请先登录");let b=new FormData;b.set("suite_id",n),b.set("source",v),Array.from(t).forEach(a=>b.append("files",a));let c=await fetch("/api/admin/eval-cases/upload",{method:"POST",headers:{Authorization:`Bearer ${a}`},body:b}),d=await c.json();if(!c.ok)throw Error(d?.message||"上传失败");alert(`上传成功：${(d.items||[]).length} 张`)}catch(a){i(a?.message||"上传失败")}finally{k(!1)}}async function J(){i(null),C(null),E([]),k(!0);try{if(!n)throw Error("请先选择数据集");let a=await F();if(!a)throw Error("请先登录");let b=await fetch("/api/admin/eval-runs/run",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({suite_id:n,model_name:x,prompt_version:z})}),c=await b.json();if(!b.ok)throw Error(c?.message||"执行失败");C(c);let d=await fetch(`/api/admin/eval-runs/results?run_id=${encodeURIComponent(c.run_id)}`,{headers:{Authorization:`Bearer ${a}`}}),e=await d.json();d.ok&&E(e.items||[])}catch(a){i(a?.message||"执行失败")}finally{k(!1)}}return((0,c.useMemo)(async()=>{let{data:a}=await d.supabase.auth.getSession();return a.session?.access_token||""},[a?.id]),(0,c.useEffect)(()=>{d.supabase.auth.getSession().then(({data:a})=>e(a.session?.user??null));let{data:a}=d.supabase.auth.onAuthStateChange((a,b)=>e(b?.user??null));return()=>a.subscription.unsubscribe()},[]),(0,c.useEffect)(()=>{a&&G()},[a?.id]),a)?!f&&h?(0,b.jsxs)("div",{className:"min-h-screen p-6 max-w-3xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"评测后台 · 执行台"}),(0,b.jsx)("div",{className:"mt-4 p-3 border rounded bg-yellow-50 text-sm text-yellow-800",children:h})]}):(0,b.jsxs)("div",{className:"min-h-screen p-6 max-w-3xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"评测后台 · 执行台"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"创建数据集 → 批量上传测试图 → 一键跑实验（落库 metrics）。"}),h&&(0,b.jsx)("div",{className:"mt-4 p-3 border rounded bg-red-50 text-sm text-red-700",children:h}),(0,b.jsxs)("div",{className:"mt-6 p-4 border rounded",children:[(0,b.jsx)("div",{className:"font-medium mb-3",children:"数据集（Suite）"}),(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsxs)("select",{className:"border rounded px-3 py-2 w-full",value:n,onChange:a=>o(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"请选择"}),l.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),(0,b.jsx)("button",{className:"border rounded px-3 py-2 text-sm",onClick:G,disabled:j,children:"刷新"})]}),(0,b.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-2",children:[(0,b.jsx)("input",{className:"border rounded px-3 py-2",value:p,onChange:a=>q(a.target.value),placeholder:"新数据集名称"}),(0,b.jsx)("input",{className:"border rounded px-3 py-2",value:r,onChange:a=>s(a.target.value),placeholder:"描述（可选）"}),(0,b.jsx)("button",{className:"border rounded px-3 py-2 bg-black text-white disabled:opacity-50",onClick:H,disabled:j||!p.trim(),children:"创建数据集"})]})]}),(0,b.jsxs)("div",{className:"mt-6 p-4 border rounded",children:[(0,b.jsx)("div",{className:"font-medium mb-3",children:"批量上传测试图片（Case）"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,b.jsx)("input",{className:"border rounded px-3 py-2",value:v,onChange:a=>w(a.target.value),placeholder:"source（例如 food-test）"}),(0,b.jsx)("input",{className:"border rounded px-3 py-2",type:"file",accept:"image/*",multiple:!0,onChange:a=>u(a.target.files)}),(0,b.jsx)("button",{className:"border rounded px-3 py-2 bg-black text-white disabled:opacity-50",onClick:I,disabled:j||!n,children:"上传"}),(0,b.jsxs)("div",{className:"text-xs text-gray-600",children:["会把文件名中的 ",(0,b.jsx)("code",{children:"xxxg"})," 自动解析为 ",(0,b.jsx)("code",{children:"ground_truth.total_weight_grams"}),"（如有）。"]})]})]}),(0,b.jsxs)("div",{className:"mt-6 p-4 border rounded",children:[(0,b.jsx)("div",{className:"font-medium mb-3",children:"跑实验（Run）"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,b.jsx)("input",{className:"border rounded px-3 py-2",value:x,onChange:a=>y(a.target.value),placeholder:"model_name"}),(0,b.jsx)("input",{className:"border rounded px-3 py-2",value:z,onChange:a=>A(a.target.value),placeholder:"prompt_version"}),(0,b.jsx)("button",{className:"border rounded px-3 py-2 bg-green-600 text-white disabled:opacity-50",onClick:J,disabled:j||!n,children:"一键执行（顺序跑，耗时取决于图片数）"})]}),B&&(0,b.jsxs)("div",{className:"mt-3 text-sm border rounded p-3 bg-gray-50",children:["run_id: ",(0,b.jsx)("code",{children:B.run_id}),"，成功 ",B.ok," / 失败 ",B.failed," / 总计 ",B.total]}),D.length>0&&(0,b.jsx)("div",{className:"mt-3 border rounded overflow-hidden",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left p-2",children:"case_id"}),(0,b.jsx)("th",{className:"text-left p-2",children:"mape"}),(0,b.jsx)("th",{className:"text-left p-2",children:"abs_error(g)"}),(0,b.jsx)("th",{className:"text-left p-2",children:"error"})]})}),(0,b.jsx)("tbody",{children:D.map(a=>(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"p-2 font-mono",children:a.case_id}),(0,b.jsx)("td",{className:"p-2",children:a.metrics?.mape!=null?Number(a.metrics.mape).toFixed(3):"-"}),(0,b.jsx)("td",{className:"p-2",children:a.metrics?.abs_error_grams!=null?Math.round(Number(a.metrics.abs_error_grams)):"-"}),(0,b.jsx)("td",{className:"p-2 text-red-700",children:a.error_message||""})]},a.id))})]})})]})]}):(0,b.jsxs)("div",{className:"min-h-screen p-6 max-w-3xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"评测后台 · 执行台"}),(0,b.jsx)("div",{className:"mt-4 p-3 border rounded bg-gray-50 text-sm",children:"请先在首页登录后再访问。"})]})}a.s(["default",()=>e])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__42ae5217._.js.map