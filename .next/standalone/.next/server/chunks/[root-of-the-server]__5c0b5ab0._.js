module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},78143,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),i=e.i(74677),o=e.i(69741),p=e.i(16795),l=e.i(87718),u=e.i(95169),d=e.i(47587),c=e.i(66012),m=e.i(70101),h=e.i(26937),x=e.i(10372),g=e.i(93695);e.i(52474);var y=e.i(5232),R=e.i(89171),v=e.i(34731);async function f(e){try{let t,r=process.env.GEMINI_API_KEY||process.env.API_KEY;if(!r)return R.NextResponse.json({message:"缺少 GEMINI_API_KEY（或 API_KEY）环境变量"},{status:500});let a=await e.json(),n=String(a?.base64Image||""),s=String(a?.additionalContext||""),i=String(a?.modelName||"gemini-3-pro-preview");if(!n)return R.NextResponse.json({message:"base64Image 不能为空"},{status:400});let o=new v.GoogleGenAI({apiKey:r}),p=`
请作为专业的营养师分析这张食物图片。
1. 识别图中所有不同的食物单品。
2. 估算每种食物的重量（克）和详细营养成分。
3. description: 提供这顿饭的简短中文描述。
4. insight: 提供一个“洞察”建议：基于该餐营养成分的一句话健康建议（例如：“蛋白质含量高，适合肌肉恢复”或“建议加点绿叶菜以平衡碳水”）。

${s?`用户补充背景信息: "${s}"。请根据此信息调整对隐形成分或烹饪方式的判断。`:""}

重要：请务必使用**简体中文**返回所有文本内容（包括 name, description, insight）。
请严格按照指定的 JSON 格式返回数据。
`.trim(),l={inlineData:{mimeType:"image/jpeg",data:n.includes(",")?n.split(",")[1]:n}},u=(await o.models.generateContent({model:i,contents:{parts:[l,{text:p}]},config:{responseMimeType:"application/json",responseSchema:{type:v.Type.OBJECT,properties:{items:{type:v.Type.ARRAY,items:{type:v.Type.OBJECT,properties:{name:{type:v.Type.STRING,description:"食物名称，使用简体中文"},estimatedWeightGrams:{type:v.Type.NUMBER},nutrients:{type:v.Type.OBJECT,properties:{calories:{type:v.Type.NUMBER},protein:{type:v.Type.NUMBER},carbs:{type:v.Type.NUMBER},fat:{type:v.Type.NUMBER},fiber:{type:v.Type.NUMBER},sugar:{type:v.Type.NUMBER}},required:["calories","protein","carbs","fat","fiber","sugar"]}},required:["name","estimatedWeightGrams","nutrients"]}},description:{type:v.Type.STRING,description:"餐食描述，使用简体中文"},insight:{type:v.Type.STRING,description:"健康建议，使用简体中文"}},required:["items","description","insight"]}}})).text;if(!u)throw Error("AI 返回了空响应，请检查图片或稍后重试。");u=u.replace(/```json/g,"").replace(/```/g,"").trim();try{t=JSON.parse(u)}catch{throw Error("AI 数据解析失败，请重试。")}let d=Array.isArray(t.items)?t.items.map(e=>{let t={calories:Number(e?.nutrients?.calories)||0,protein:Number(e?.nutrients?.protein)||0,carbs:Number(e?.nutrients?.carbs)||0,fat:Number(e?.nutrients?.fat)||0,fiber:Number(e?.nutrients?.fiber)||0,sugar:Number(e?.nutrients?.sugar)||0};return{name:String(e?.name||"未知食物"),estimatedWeightGrams:Number(e?.estimatedWeightGrams)||0,originalWeightGrams:Number(e?.estimatedWeightGrams)||0,nutrients:t}}):[];return R.NextResponse.json({description:String(t.description||"无法获取描述"),insight:String(t.insight||"保持健康饮食！"),items:d})}catch(e){return console.error("[api/analyze] error:",e),R.NextResponse.json({message:e?.message||"连接 AI 服务失败"},{status:500})}}e.s(["POST",()=>f],23892);var E=e.i(23892);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/analyze/route.ts",nextConfigOutput:"standalone",userland:E}),{workAsyncStorage:b,workUnitAsyncStorage:T,serverHooks:w}=N;function A(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:T})}async function _(e,t,a){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/analyze/route";R=R.replace(/\/index$/,"")||"/";let v=await N.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:f,params:E,nextConfig:b,parsedUrl:T,isDraftMode:w,prerenderManifest:A,routerServerContext:_,isOnDemandRevalidate:C,revalidateOnlyGenerated:q,resolvedPathname:I,clientReferenceManifest:S,serverActionsManifest:P}=v,j=(0,o.normalizeAppPath)(R),O=!!(A.dynamicRoutes[j]||A.routes[I]),k=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,T,!1):t.end("This page could not be found"),null);if(O&&!w){let e=!!A.routes[I],t=A.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await k();throw new g.NoFallbackError}}let U=null;!O||N.isDev||w||(U="/index"===(U=I)?"/":U);let M=!0===N.isDev||!O,H=O&&!M;P&&S&&(0,i.setManifestsSingleton)({page:R,clientReferenceManifest:S,serverActionsManifest:P});let G=e.method||"GET",B=(0,s.getTracer)(),D=B.getActiveScopeSpan(),K={params:E,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>N.onRequestError(e,t,a,n,_)},sharedContext:{buildId:f}},$=new p.NodeNextRequest(e),F=new p.NodeNextResponse(t),W=l.NextRequestAdapter.fromNodeNextRequest($,(0,l.signalFromNodeResponse)(t));try{let i=async e=>N.handle(W,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${G} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${G} ${R}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),p=async n=>{var s,p;let l=async({previousCacheEntry:r})=>{try{if(!o&&C&&q&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let p=K.renderOpts.pendingWaitUntil;p&&a.waitUntil&&(a.waitUntil(p),p=void 0);let l=K.renderOpts.collectedTags;if(!O)return await (0,c.sendResponse)($,F,s,K.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[x.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,_),t}},u=await N.handleResponse({req:e,nextConfig:b,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:q,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:o});if(!O)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(p=u.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",C?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&O||g.delete(x.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,c.sendResponse)($,F,new Response(u.value.body,{headers:g,status:u.value.status||200})),null};D?await p(D):await B.withPropagatedContext(e.headers,()=>B.trace(u.BaseServerSpan.handleRequest,{spanName:`${G} ${R}`,kind:s.SpanKind.SERVER,attributes:{"http.method":G,"http.target":e.url}},p))}catch(t){if(t instanceof g.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,_),O)throw t;return await (0,c.sendResponse)($,F,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>A,"routeModule",()=>N,"serverHooks",()=>w,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>T],78143)},85685,e=>{e.v(e=>Promise.resolve().then(()=>e(54799)))},91961,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__fda9c04e._.js"].map(t=>e.l(t))).then(()=>t(12111)))},72331,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_node-fetch_src_utils_multipart-parser_0316998b.js","server/chunks/[root-of-the-server]__c08a7b0d._.js","server/chunks/[root-of-the-server]__e24658a7._.js"].map(t=>e.l(t))).then(()=>t(20442)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5c0b5ab0._.js.map