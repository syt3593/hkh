{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../app/admin/page.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","'use client'\n\nimport React, { useEffect, useMemo, useState } from 'react'\nimport { supabase } from '../../lib/supabase'\nimport type { User } from '@supabase/supabase-js'\n\ntype AdminRow = { user_id: string; role: 'admin' | 'evaluator'; created_at: string }\n\nexport default function AdminPage() {\n  const [user, setUser] = useState<User | null>(null)\n  const [isAdmin, setIsAdmin] = useState(false)\n  const [items, setItems] = useState<AdminRow[]>([])\n  const [loading, setLoading] = useState(false)\n  const [err, setErr] = useState<string | null>(null)\n\n  const [newUserId, setNewUserId] = useState('')\n  const [newRole, setNewRole] = useState<'admin' | 'evaluator'>('evaluator')\n\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data }) => setUser(data.session?.user ?? null))\n    const { data } = supabase.auth.onAuthStateChange((_evt, session) => setUser(session?.user ?? null))\n    return () => data.subscription.unsubscribe()\n  }, [])\n\n  async function refresh() {\n    setErr(null)\n    setLoading(true)\n    try {\n      const { data: sessionData } = await supabase.auth.getSession()\n      const accessToken = sessionData.session?.access_token\n      if (!accessToken) {\n        setIsAdmin(false)\n        setItems([])\n        return\n      }\n      const res = await fetch('/api/admin/eval-admins', {\n        headers: { Authorization: `Bearer ${accessToken}` },\n      })\n      const json = await res.json()\n      if (!res.ok) {\n        setIsAdmin(false)\n        setItems([])\n        setErr(json?.message || '无权限或请求失败')\n        return\n      }\n      setIsAdmin(true)\n      setItems(json.items || [])\n    } catch (e: any) {\n      setErr(e?.message || '请求失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    refresh()\n  }, [user?.id])\n\n  async function addOrUpdate() {\n    setErr(null)\n    setLoading(true)\n    try {\n      const { data: sessionData } = await supabase.auth.getSession()\n      const accessToken = sessionData.session?.access_token\n      if (!accessToken) throw new Error('请先登录')\n      const res = await fetch('/api/admin/eval-admins', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${accessToken}`,\n        },\n        body: JSON.stringify({ user_id: newUserId.trim(), role: newRole }),\n      })\n      const json = await res.json()\n      if (!res.ok) throw new Error(json?.message || '操作失败')\n      setNewUserId('')\n      await refresh()\n    } catch (e: any) {\n      setErr(e?.message || '操作失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function remove(userId: string) {\n    if (!confirm(`确认移除该评测权限？\\n${userId}`)) return\n    setErr(null)\n    setLoading(true)\n    try {\n      const { data: sessionData } = await supabase.auth.getSession()\n      const accessToken = sessionData.session?.access_token\n      if (!accessToken) throw new Error('请先登录')\n      const res = await fetch('/api/admin/eval-admins', {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${accessToken}`,\n        },\n        body: JSON.stringify({ user_id: userId }),\n      })\n      const json = await res.json()\n      if (!res.ok) throw new Error(json?.message || '操作失败')\n      await refresh()\n    } catch (e: any) {\n      setErr(e?.message || '操作失败')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen p-6 max-w-3xl mx-auto\">\n      <h1 className=\"text-2xl font-semibold\">评测后台 · 管理员</h1>\n      <p className=\"text-sm text-gray-600 mt-2\">\n        仅 <code>eval_admins.role=admin</code> 可管理评测白名单。普通用户不可见。\n      </p>\n      <div className=\"mt-3 text-sm\">\n        <a className=\"underline\" href=\"/admin/eval\">\n          前往评测执行台（上传数据集 / 跑实验）\n        </a>\n      </div>\n\n      {!user && (\n        <div className=\"mt-4 p-3 border rounded bg-gray-50 text-sm\">\n          你尚未登录。请先在首页登录后再访问此页面。\n        </div>\n      )}\n\n      {err && <div className=\"mt-4 p-3 border rounded bg-red-50 text-sm text-red-700\">{err}</div>}\n\n      {user && !isAdmin && !loading && (\n        <div className=\"mt-4 p-3 border rounded bg-yellow-50 text-sm text-yellow-800\">\n          你不是管理员，无法管理评测权限。\n        </div>\n      )}\n\n      {user && isAdmin && (\n        <>\n          <div className=\"mt-6 p-4 border rounded\">\n            <div className=\"font-medium mb-3\">新增 / 更新评测权限</div>\n            <div className=\"flex flex-col gap-2\">\n              <label className=\"text-sm\">\n                user_id（UUID）\n                <input\n                  className=\"mt-1 w-full border rounded px-3 py-2\"\n                  value={newUserId}\n                  onChange={(e) => setNewUserId(e.target.value)}\n                  placeholder=\"例如：2c0f...-....-....\"\n                />\n              </label>\n              <label className=\"text-sm\">\n                role\n                <select\n                  className=\"mt-1 w-full border rounded px-3 py-2\"\n                  value={newRole}\n                  onChange={(e) => setNewRole(e.target.value as any)}\n                >\n                  <option value=\"evaluator\">evaluator（可跑实验/维护数据集）</option>\n                  <option value=\"admin\">admin（额外拥有删除/管理权限）</option>\n                </select>\n              </label>\n              <button\n                className=\"mt-2 border rounded px-3 py-2 bg-black text-white disabled:opacity-50\"\n                onClick={addOrUpdate}\n                disabled={loading || !newUserId.trim()}\n              >\n                保存\n              </button>\n            </div>\n          </div>\n\n          <div className=\"mt-6 flex items-center justify-between\">\n            <div className=\"font-medium\">当前白名单</div>\n            <button className=\"border rounded px-3 py-2 text-sm\" onClick={refresh} disabled={loading}>\n              刷新\n            </button>\n          </div>\n\n          <div className=\"mt-3 border rounded overflow-hidden\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"text-left p-2\">user_id</th>\n                  <th className=\"text-left p-2\">role</th>\n                  <th className=\"text-left p-2\">created_at</th>\n                  <th className=\"p-2\"></th>\n                </tr>\n              </thead>\n              <tbody>\n                {items.length === 0 && (\n                  <tr>\n                    <td className=\"p-2 text-gray-600\" colSpan={4}>\n                      暂无数据\n                    </td>\n                  </tr>\n                )}\n                {items.map((it) => (\n                  <tr key={it.user_id} className=\"border-t\">\n                    <td className=\"p-2 font-mono\">{it.user_id}</td>\n                    <td className=\"p-2\">{it.role}</td>\n                    <td className=\"p-2\">{new Date(it.created_at).toLocaleString()}</td>\n                    <td className=\"p-2 text-right\">\n                      <button className=\"border rounded px-2 py-1\" onClick={() => remove(it.user_id)} disabled={loading}>\n                        移除\n                      </button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </>\n      )}\n    </div>\n  )\n}\n\n\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}