module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},97877,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].React},88367,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(78560);function e(){let[a,e]=(0,c.useState)(null),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)("evaluator");async function r(){m(null),k(!0);try{let{data:a}=await d.supabase.auth.getSession(),b=a.session?.access_token;if(!b){g(!1),i([]);return}let c=await fetch("/api/admin/eval-admins",{headers:{Authorization:`Bearer ${b}`}}),e=await c.json();if(!c.ok){g(!1),i([]),m(e?.message||"无权限或请求失败");return}g(!0),i(e.items||[])}catch(a){m(a?.message||"请求失败")}finally{k(!1)}}async function s(){m(null),k(!0);try{let{data:a}=await d.supabase.auth.getSession(),b=a.session?.access_token;if(!b)throw Error("请先登录");let c=await fetch("/api/admin/eval-admins",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({user_id:n.trim(),role:p})}),e=await c.json();if(!c.ok)throw Error(e?.message||"操作失败");o(""),await r()}catch(a){m(a?.message||"操作失败")}finally{k(!1)}}async function t(a){if(confirm(`确认移除该评测权限？
${a}`)){m(null),k(!0);try{let{data:b}=await d.supabase.auth.getSession(),c=b.session?.access_token;if(!c)throw Error("请先登录");let e=await fetch("/api/admin/eval-admins",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({user_id:a})}),f=await e.json();if(!e.ok)throw Error(f?.message||"操作失败");await r()}catch(a){m(a?.message||"操作失败")}finally{k(!1)}}}return(0,c.useEffect)(()=>{d.supabase.auth.getSession().then(({data:a})=>e(a.session?.user??null));let{data:a}=d.supabase.auth.onAuthStateChange((a,b)=>e(b?.user??null));return()=>a.subscription.unsubscribe()},[]),(0,c.useEffect)(()=>{r()},[a?.id]),(0,b.jsxs)("div",{className:"min-h-screen p-6 max-w-3xl mx-auto",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"评测后台 · 管理员"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["仅 ",(0,b.jsx)("code",{children:"eval_admins.role=admin"})," 可管理评测白名单。普通用户不可见。"]}),(0,b.jsx)("div",{className:"mt-3 text-sm",children:(0,b.jsx)("a",{className:"underline",href:"/admin/eval",children:"前往评测执行台（上传数据集 / 跑实验）"})}),!a&&(0,b.jsx)("div",{className:"mt-4 p-3 border rounded bg-gray-50 text-sm",children:"你尚未登录。请先在首页登录后再访问此页面。"}),l&&(0,b.jsx)("div",{className:"mt-4 p-3 border rounded bg-red-50 text-sm text-red-700",children:l}),a&&!f&&!j&&(0,b.jsx)("div",{className:"mt-4 p-3 border rounded bg-yellow-50 text-sm text-yellow-800",children:"你不是管理员，无法管理评测权限。"}),a&&f&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mt-6 p-4 border rounded",children:[(0,b.jsx)("div",{className:"font-medium mb-3",children:"新增 / 更新评测权限"}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsxs)("label",{className:"text-sm",children:["user_id（UUID）",(0,b.jsx)("input",{className:"mt-1 w-full border rounded px-3 py-2",value:n,onChange:a=>o(a.target.value),placeholder:"例如：2c0f...-....-...."})]}),(0,b.jsxs)("label",{className:"text-sm",children:["role",(0,b.jsxs)("select",{className:"mt-1 w-full border rounded px-3 py-2",value:p,onChange:a=>q(a.target.value),children:[(0,b.jsx)("option",{value:"evaluator",children:"evaluator（可跑实验/维护数据集）"}),(0,b.jsx)("option",{value:"admin",children:"admin（额外拥有删除/管理权限）"})]})]}),(0,b.jsx)("button",{className:"mt-2 border rounded px-3 py-2 bg-black text-white disabled:opacity-50",onClick:s,disabled:j||!n.trim(),children:"保存"})]})]}),(0,b.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,b.jsx)("div",{className:"font-medium",children:"当前白名单"}),(0,b.jsx)("button",{className:"border rounded px-3 py-2 text-sm",onClick:r,disabled:j,children:"刷新"})]}),(0,b.jsx)("div",{className:"mt-3 border rounded overflow-hidden",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left p-2",children:"user_id"}),(0,b.jsx)("th",{className:"text-left p-2",children:"role"}),(0,b.jsx)("th",{className:"text-left p-2",children:"created_at"}),(0,b.jsx)("th",{className:"p-2"})]})}),(0,b.jsxs)("tbody",{children:[0===h.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{className:"p-2 text-gray-600",colSpan:4,children:"暂无数据"})}),h.map(a=>(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"p-2 font-mono",children:a.user_id}),(0,b.jsx)("td",{className:"p-2",children:a.role}),(0,b.jsx)("td",{className:"p-2",children:new Date(a.created_at).toLocaleString()}),(0,b.jsx)("td",{className:"p-2 text-right",children:(0,b.jsx)("button",{className:"border rounded px-2 py-1",onClick:()=>t(a.user_id),disabled:j,children:"移除"})})]},a.user_id))]})]})})]})]})}a.s(["default",()=>e])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d984dfed._.js.map