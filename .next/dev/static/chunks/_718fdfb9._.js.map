{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/files/hkh/types.ts"],"sourcesContent":["\r\nexport interface Nutrients {\r\n  calories: number;\r\n  protein: number;\r\n  carbs: number;\r\n  fat: number;\r\n  fiber: number;\r\n  sugar: number;\r\n}\r\n\r\nexport interface FoodItem {\r\n  id: string;\r\n  name: string;\r\n  estimatedWeightGrams: number; // 当前数值（用户可能修改过）\r\n  originalWeightGrams: number;  // AI 初始数值（用于计算偏差）\r\n  nutrients: Nutrients;\r\n  consumedPercentage: number; // 0-100\r\n}\r\n\r\nexport interface FoodScan {\r\n  id: string;\r\n  timestamp: number;\r\n  imageUrl: string;\r\n  description: string;\r\n  insight: string; \r\n  items: FoodItem[];\r\n  globalScale: number; // 0-100\r\n}\r\n\r\n// 重点样本：偏差超过阈值的记录\r\nexport interface CriticalSample {\r\n  id: string;\r\n  timestamp: number;\r\n  imageUrl: string;\r\n  foodName: string;\r\n  aiWeight: number;\r\n  userWeight: number;\r\n  deviationPercent: number; // e.g. +50% or -30%\r\n}\r\n\r\n// 常餐模版：用户保存的固定搭配\r\nexport interface StapleMeal {\r\n  id: string;\r\n  name: string;\r\n  imageUrl: string;\r\n  items: Omit<FoodItem, 'id'>[]; // 存储模版时的组成\r\n  totalCalories: number;\r\n}\r\n\r\nexport enum AppState {\r\n  IDLE = 'IDLE',\r\n  CAMERA = 'CAMERA',\r\n  ANALYZING = 'ANALYZING',\r\n  RESULT = 'RESULT',\r\n  HISTORY = 'HISTORY',\r\n  CRITICAL_SAMPLES = 'CRITICAL_SAMPLES' // 新增状态\r\n}\r\n"],"names":[],"mappings":";;;;AAiDO,IAAA,AAAK,kCAAA;;;;;;uDAM4B,OAAO;WANnC"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///D:/files/hkh/services/geminiService.ts"],"sourcesContent":["\r\nexport async function analyzeFoodImage(\r\n  base64Image: string, \r\n  additionalContext: string,\r\n  modelName: string = \"gemini-3-pro-preview\"\r\n): Promise<{\r\n  items: any[];\r\n  description: string;\r\n  insight: string;\r\n}> {\r\n  try {\r\n    const res = await fetch('/api/analyze', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ base64Image, additionalContext, modelName }),\r\n    })\r\n\r\n    const data = await res.json().catch(() => ({}))\r\n    if (!res.ok) {\r\n      throw new Error(data?.message || '连接 AI 服务失败')\r\n    }\r\n    return data\r\n  } catch (error: any) {\r\n    console.error('Gemini API Error:', error)\r\n    throw new Error(error.message || '连接 AI 服务失败')\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AACO,eAAe,iBACpB,WAAmB,EACnB,iBAAyB,EACzB,YAAoB,sBAAsB;IAM1C,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,gBAAgB;YACtC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAa;gBAAmB;YAAU;QACnE;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC7C,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,IAAI,MAAM,MAAM,WAAW;QACnC;QACA,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qBAAqB;QACnC,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;AACF"}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/files/hkh/components/NutrientBadge.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\n\r\ninterface NutrientBadgeProps {\r\n  label: string;\r\n  value: number;\r\n  unit: string;\r\n  color: string;\r\n  icon: React.ReactNode;\r\n}\r\n\r\nconst NutrientBadge: React.FC<NutrientBadgeProps> = ({ label, value, unit, color, icon }) => {\r\n  return (\r\n    <div className={`flex flex-col items-center p-3 rounded-2xl bg-white shadow-sm border border-gray-100`}>\r\n      <div className={`p-2 rounded-full mb-2 ${color} text-white`}>\r\n        {icon}\r\n      </div>\r\n      <span className=\"text-xs text-gray-500 font-medium uppercase tracking-wider\">{label}</span>\r\n      <div className=\"flex items-baseline gap-1 mt-1\">\r\n        <span className=\"text-xl font-bold text-gray-800\">{value.toFixed(1)}</span>\r\n        <span className=\"text-xs text-gray-400 font-medium\">{unit}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NutrientBadge;\r\n"],"names":[],"mappings":";;;;;;AAWA,MAAM,gBAA8C,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE;IACtF,qBACE,6LAAC;QAAI,WAAW,CAAC,oFAAoF,CAAC;;0BACpG,6LAAC;gBAAI,WAAW,CAAC,sBAAsB,EAAE,MAAM,WAAW,CAAC;0BACxD;;;;;;0BAEH,6LAAC;gBAAK,WAAU;0BAA8D;;;;;;0BAC9E,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAK,WAAU;kCAAmC,MAAM,OAAO,CAAC;;;;;;kCACjE,6LAAC;wBAAK,WAAU;kCAAqC;;;;;;;;;;;;;;;;;;AAI7D;KAbM;uCAeS"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///D:/files/hkh/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  console.warn('Supabase credentials are missing. Please check your .env.local file.');\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n\r\n"],"names":[],"mappings":";;;;AAEoB;AAFpB;;AAEA,MAAM,cAAc,gFAAwC;AAC5D,MAAM,kBAAkB,wPAA6C;AAErE;;AAIO,MAAM,WAAW,IAAA,iMAAY,EAAC,aAAa"}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file:///D:/files/hkh/services/supabaseService.ts"],"sourcesContent":["import { supabase } from '../lib/supabase';\r\nimport { FoodScan, StapleMeal, CriticalSample } from '../types';\r\n\r\n/**\r\n * 将 base64 图片上传到 Supabase Storage\r\n */\r\nexport async function uploadImage(base64Data: string): Promise<string> {\r\n  try {\r\n    // 移除 base64 前缀并转换为 Blob\r\n    const base64Str = base64Data.includes(',') ? base64Data.split(',')[1] : base64Data;\r\n    const byteCharacters = atob(base64Str);\r\n    const byteNumbers = new Array(byteCharacters.length);\r\n    for (let i = 0; i < byteCharacters.length; i++) {\r\n      byteNumbers[i] = byteCharacters.charCodeAt(i);\r\n    }\r\n    const byteArray = new Uint8Array(byteNumbers);\r\n    const blob = new Blob([byteArray], { type: 'image/jpeg' });\r\n    \r\n    const fileName = `food_${Date.now()}.jpg`;\r\n    const { data, error } = await supabase.storage\r\n      .from('food-images')\r\n      .upload(fileName, blob, {\r\n        contentType: 'image/jpeg',\r\n        upsert: false\r\n      });\r\n\r\n    if (error) throw error;\r\n\r\n    // 获取公共 URL\r\n    const { data: { publicUrl } } = supabase.storage\r\n      .from('food-images')\r\n      .getPublicUrl(data.path);\r\n\r\n    return publicUrl;\r\n  } catch (error) {\r\n    console.error('Error uploading image:', error);\r\n    throw new Error('图片上传云端失败');\r\n  }\r\n}\r\n\r\n/**\r\n * 保存识餐记录到数据库\r\n */\r\nexport async function saveMealToDb(scan: FoodScan) {\r\n  const { data: meal, error: mealError } = await supabase\r\n    .from('meals')\r\n    .insert({\r\n      timestamp: scan.timestamp,\r\n      description: scan.description,\r\n      insight: scan.insight,\r\n      image_url: scan.imageUrl,\r\n      global_scale: scan.globalScale\r\n    })\r\n    .select()\r\n    .single();\r\n\r\n  if (mealError) throw mealError;\r\n\r\n  const itemsToInsert = scan.items.map(item => ({\r\n    meal_id: meal.id,\r\n    name: item.name,\r\n    estimated_weight_grams: item.estimatedWeightGrams,\r\n    original_weight_grams: item.originalWeightGrams,\r\n    consumed_percentage: item.consumedPercentage,\r\n    nutrients: item.nutrients\r\n  }));\r\n\r\n  const { error: itemsError } = await supabase\r\n    .from('meal_items')\r\n    .insert(itemsToInsert);\r\n\r\n  if (itemsError) throw itemsError;\r\n  \r\n  return meal.id;\r\n}\r\n\r\n/**\r\n * 获取历史记录\r\n */\r\nexport async function fetchMealsFromDb(): Promise<FoodScan[]> {\r\n  const { data, error } = await supabase\r\n    .from('meals')\r\n    .select(`\r\n      *,\r\n      meal_items (*)\r\n    `)\r\n    .order('timestamp', { ascending: false })\r\n    .limit(50);\r\n\r\n  if (error) throw error;\r\n\r\n  return data.map(meal => ({\r\n    id: meal.id,\r\n    timestamp: meal.timestamp,\r\n    imageUrl: meal.image_url,\r\n    description: meal.description,\r\n    insight: meal.insight,\r\n    globalScale: meal.global_scale,\r\n    items: meal.meal_items.map((it: any) => ({\r\n      id: it.id,\r\n      name: it.name,\r\n      estimatedWeightGrams: it.estimated_weight_grams,\r\n      originalWeightGrams: it.original_weight_grams,\r\n      consumedPercentage: it.consumed_percentage,\r\n      nutrients: it.nutrients\r\n    }))\r\n  }));\r\n}\r\n\r\n/**\r\n * 保存常餐模版\r\n */\r\nexport async function saveStapleToDb(staple: Omit<StapleMeal, 'id'>) {\r\n  const { data, error } = await supabase\r\n    .from('staple_meals')\r\n    .insert({\r\n      name: staple.name,\r\n      image_url: staple.imageUrl,\r\n      total_calories: staple.totalCalories,\r\n      items: staple.items\r\n    })\r\n    .select()\r\n    .single();\r\n\r\n  if (error) throw error;\r\n  return data;\r\n}\r\n\r\n/**\r\n * 获取常餐模版\r\n */\r\nexport async function fetchStaplesFromDb(): Promise<StapleMeal[]> {\r\n  const { data, error } = await supabase\r\n    .from('staple_meals')\r\n    .select('*')\r\n    .order('created_at', { ascending: false });\r\n\r\n  if (error) throw error;\r\n\r\n  return data.map(it => ({\r\n    id: it.id,\r\n    name: it.name,\r\n    imageUrl: it.image_url,\r\n    totalCalories: it.total_calories,\r\n    items: it.items\r\n  }));\r\n}\r\n\r\n/**\r\n * 保存偏差样本\r\n */\r\nexport async function saveCriticalSampleToDb(sample: Omit<CriticalSample, 'id'>) {\r\n  const { error } = await supabase\r\n    .from('critical_samples')\r\n    .insert({\r\n      timestamp: sample.timestamp,\r\n      food_name: sample.foodName,\r\n      image_url: sample.imageUrl,\r\n      ai_weight: sample.aiWeight,\r\n      user_weight: sample.userWeight,\r\n      deviation_percent: sample.deviationPercent\r\n    });\r\n\r\n  if (error) throw error;\r\n}\r\n\r\n/**\r\n * 获取偏差样本\r\n */\r\nexport async function fetchCriticalSamplesFromDb(): Promise<CriticalSample[]> {\r\n  const { data, error } = await supabase\r\n    .from('critical_samples')\r\n    .select('*')\r\n    .order('timestamp', { ascending: false });\r\n\r\n  if (error) throw error;\r\n\r\n  return data.map(it => ({\r\n    id: it.id,\r\n    timestamp: it.timestamp,\r\n    foodName: it.food_name,\r\n    imageUrl: it.image_url,\r\n    aiWeight: it.ai_weight,\r\n    userWeight: it.user_weight,\r\n    deviationPercent: it.deviation_percent\r\n  }));\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["file:///D:/files/hkh/app/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { AppState, FoodScan, FoodItem, Nutrients, StapleMeal, CriticalSample } from '../types';\r\nimport { analyzeFoodImage } from '../services/geminiService';\r\nimport NutrientBadge from '../components/NutrientBadge';\r\nimport { \r\n  uploadImage, \r\n  saveMealToDb, \r\n  fetchMealsFromDb, \r\n  saveStapleToDb, \r\n  fetchStaplesFromDb, \r\n  saveCriticalSampleToDb, \r\n  fetchCriticalSamplesFromDb \r\n} from '../services/supabaseService';\r\n\r\nconst SpeechRecognition = typeof window !== 'undefined' ? ((window as any).SpeechRecognition || (window as any).webkitSpeechRecognition) : null;\r\n\r\nconst Icons = {\r\n  Camera: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\" /></svg>,\r\n  Upload: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z\" /></svg>,\r\n  History: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z\" /></svg>,\r\n  ArrowLeft: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18\" /></svg>,\r\n  Calories: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.213 3.536 3.751 3.751 0 0 0 1.218 3.932Z\" /></svg>,\r\n  Protein: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z\" /></svg>,\r\n  Carbs: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 3v18m0-18l-3 3m3-3l3 3m-9 6h12M9 12l3 3m-3-3l3-3m-3 9h6\" /></svg>,\r\n  Fat: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 21a9.004 9.004 0 0 0 8.716-6.747c.224-.891.076-1.785-.417-2.46-.736-1.003-1.8-1.457-2.996-1.477l-1.042-.018c-1.291-.023-2.316-.902-2.316-2.195V4.75a.75.75 0 0 0-1.5 0v3.354c0 1.293-1.026 2.172-2.317 2.195l-1.042.018c-1.196.02-2.26.474-2.996 1.477-.493.675-.641 1.569-.417 2.46A9.004 9.004 0 0 0 12 21Z\" /></svg>,\r\n  XCircle: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z\" /></svg>,\r\n    ChevronDown: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"m19.5 8.25-7.5 7.5-7.5-7.5\" /></svg>,\r\n    ChevronUp: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"m4.5 15.75 7.5-7.5 7.5 7.5\" /></svg>,\r\n  Microphone: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z\" /></svg>,\r\n  Sparkles: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09-3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l1.183.394-1.183.394a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z\" /></svg>,\r\n  Pencil: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-3 h-3\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125\" /></svg>,\r\n  Heart: (props: any) => <svg xmlns=\"http://www.w3.org/2000/svg\" fill={props.fill || \"none\"} viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z\" /></svg>,\r\n  Check: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"m4.5 12.75 6 6 9-13.5\" /></svg>,\r\n  Sun: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M3 12h2.25m.386-6.364l1.591 1.591M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z\" /></svg>,\r\n  Angle: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 19.5v-15m0 0l-3.75 3.75M12 4.5l3.75 3.75M4.5 12l7.5-7.5 7.5 7.5M4.5 15l7.5 7.5 7.5-7.5\" /></svg>,\r\n  Minus: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-3 h-3\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M19.5 12h-15\" /></svg>,\r\n  Plus: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-3 h-3\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 4.5v15m7.5-7.5h-15\" /></svg>,\r\n  Warn: () => <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-6 h-6\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z\" /></svg>,\r\n};\r\n\r\nconst MODELS = {\r\n  FLASH: 'gemini-3-flash-preview',\r\n  PRO: 'gemini-3-pro-preview'\r\n};\r\n\r\nconst CAMERA_TIPS = [\r\n  { text: \"尝试 45 度俯拍以获得最佳体积估算\", icon: <Icons.Angle /> },\r\n  { text: \"确保光线充足，避免阴影遮挡食物\", icon: <Icons.Sun /> },\r\n  { text: \"在旁边放一把勺子或手作为大小参考\", icon: <Icons.Sparkles /> },\r\n  { text: \"尽量让所有食物都处于中心区域\", icon: <Icons.Camera /> }\r\n];\r\n\r\nconst HEALTH_TIPS = [\r\n  \"吃饭顺序有讲究：先吃蔬菜，再吃蛋白质，最后吃碳水，可以有效平稳血糖。\",\r\n  \"每一口食物咀嚼 20-30 次，不仅助消化，还能提升饱腹感，减少过量进食。\",\r\n  \"餐前 30 分钟喝一杯水，可以激活新陈代谢，并自然减少正餐摄入量。\",\r\n  \"早餐摄入 30g 蛋白质（如鸡蛋、牛奶），可以防止午餐前的饥饿感和对甜食的渴望。\",\r\n  \"冷掉的米饭或土豆含有更多'抗性淀粉'，热量吸收会比热着吃减少很多。\",\r\n  \"深色蔬菜（如菠菜、紫甘蓝）通常比浅色蔬菜含有更多的抗氧化剂和微量元素。\",\r\n  \"进食高碳水食物前喝一点醋或柠檬水，有助于降低胰岛素反应，减少脂肪堆积。\",\r\n  \"尽量在睡前 3 小时停止进食，让肠胃有充分的时间休息和修复。\"\r\n];\r\n\r\nconst compressImage = (base64Str: string, maxWidth = 800, quality = 0.6): Promise<string> => {\r\n  return new Promise((resolve) => {\r\n    const img = new Image();\r\n    img.src = base64Str;\r\n    img.onload = () => {\r\n      const canvas = document.createElement('canvas');\r\n      let width = img.width;\r\n      let height = img.height;\r\n      if (width > maxWidth) {\r\n        height = Math.round((height * maxWidth) / width);\r\n        width = maxWidth;\r\n      }\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      const ctx = canvas.getContext('2d');\r\n      ctx?.drawImage(img, 0, 0, width, height);\r\n      resolve(canvas.toDataURL('image/jpeg', quality));\r\n    };\r\n    img.onerror = () => resolve(base64Str);\r\n  });\r\n};\r\n\r\nexport default function FoodTrackerPage() {\r\n  const [state, setState] = useState<AppState>(AppState.IDLE);\r\n  const [selectedModel, setSelectedModel] = useState(MODELS.FLASH);\r\n  const [history, setHistory] = useState<FoodScan[]>([]);\r\n  const [staples, setStaples] = useState<StapleMeal[]>([]);\r\n  const [criticalSamples, setCriticalSamples] = useState<CriticalSample[]>([]);\r\n  \r\n  const [currentScan, setCurrentScan] = useState<FoodScan | null>(null);\r\n  const [expandedItemId, setExpandedItemId] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isConfirming, setIsConfirming] = useState(false);\r\n  const [additionalContext, setAdditionalContext] = useState('');\r\n  const [tempImageUrl, setTempImageUrl] = useState<string | null>(null);\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [currentTipIndex, setCurrentTipIndex] = useState(0);\r\n  const [currentHealthTip, setCurrentHealthTip] = useState(0);\r\n  \r\n  const [isSavingStaple, setIsSavingStaple] = useState(false);\r\n  const [stapleNameInput, setStapleNameInput] = useState('');\r\n  const [showStapleSuccess, setShowStapleSuccess] = useState(false);\r\n  const [capturedCriticals, setCapturedCriticals] = useState<number>(0);\r\n  const [criticalToastMessage, setCriticalToastMessage] = useState<string>('');\r\n  \r\n  const [hasSavedCritical, setHasSavedCritical] = useState(false);\r\n  const [manualMarkError, setManualMarkError] = useState<string | null>(null);\r\n\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    async function loadData() {\r\n      try {\r\n        const [meals, staplesData, samples] = await Promise.all([\r\n          fetchMealsFromDb(),\r\n          fetchStaplesFromDb(),\r\n          fetchCriticalSamplesFromDb()\r\n        ]);\r\n        setHistory(meals);\r\n        setStaples(staplesData);\r\n        setCriticalSamples(samples);\r\n      } catch (e) {\r\n        console.error(\"Failed to load data from Supabase\", e);\r\n        // 如果云端加载失败，尝试回退到 localStorage (可选)\r\n        const savedHistory = localStorage.getItem('nutrilens_history_v4');\r\n        if (savedHistory) setHistory(JSON.parse(savedHistory));\r\n      }\r\n    }\r\n    loadData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let interval: any;\r\n    if (state === AppState.ANALYZING) {\r\n      interval = setInterval(() => {\r\n         setCurrentHealthTip(prev => (prev + 1) % HEALTH_TIPS.length);\r\n      }, 3000);\r\n    }\r\n    return () => clearInterval(interval);\r\n  }, [state]);\r\n\r\n  const safeLocalStorageSet = (key: string, value: any, setter: (val: any) => void) => {\r\n    try {\r\n      localStorage.setItem(key, JSON.stringify(value));\r\n      setter(value);\r\n    } catch (e: any) {\r\n      if (e.name === 'QuotaExceededError' || e.code === 22) {\r\n        if (Array.isArray(value) && value.length > 1) {\r\n           const trimmedValue = value.slice(0, Math.floor(value.length * 0.8));\r\n           safeLocalStorageSet(key, trimmedValue, setter);\r\n        } else {\r\n           setError(\"手机存储空间已满，无法保存新记录，请清理历史数据。\");\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const saveToHistory = async (scan: FoodScan) => {\r\n    try {\r\n      await saveMealToDb(scan);\r\n      setHistory(prev => [scan, ...prev].slice(0, 50));\r\n    } catch (e) {\r\n      console.error(\"Failed to save to Supabase\", e);\r\n      // 回退到 localStorage\r\n      safeLocalStorageSet('nutrilens_history_v4', [scan, ...history].slice(0, 50), setHistory);\r\n    }\r\n  };\r\n\r\n  const processCriticalSamples = async (scan: FoodScan, isManual: boolean) => {\r\n    if (hasSavedCritical) return;\r\n    const newCriticals: CriticalSample[] = [];\r\n    const threshold = isManual ? 0 : 0.3;\r\n    \r\n    scan.items.forEach(item => {\r\n      if (item.originalWeightGrams && item.originalWeightGrams > 0) {\r\n         const diff = item.estimatedWeightGrams - item.originalWeightGrams;\r\n         const percent = (diff / item.originalWeightGrams);\r\n         if (Math.abs(percent) > threshold && Math.abs(diff) > 1) {\r\n            newCriticals.push({\r\n               id: Date.now() + Math.random().toString(),\r\n               timestamp: Date.now(),\r\n               imageUrl: scan.imageUrl,\r\n               foodName: item.name,\r\n               aiWeight: item.originalWeightGrams,\r\n               userWeight: item.estimatedWeightGrams,\r\n               deviationPercent: Math.round(percent * 100)\r\n            });\r\n         }\r\n      }\r\n    });\r\n\r\n    if (newCriticals.length > 0) {\r\n       try {\r\n         await Promise.all(newCriticals.map(sample => saveCriticalSampleToDb(sample)));\r\n         const updatedCriticals = [...newCriticals, ...criticalSamples].slice(0, 50);\r\n         setCriticalSamples(updatedCriticals);\r\n         setCriticalToastMessage(isManual ? `已手动归档 ${newCriticals.length} 个样本` : `已自动归档 ${newCriticals.length} 个大偏差样本`);\r\n         setCapturedCriticals(newCriticals.length);\r\n         setTimeout(() => setCapturedCriticals(0), 4000);\r\n         setHasSavedCritical(true);\r\n         setManualMarkError(null);\r\n       } catch (e) {\r\n         console.error(\"Failed to save critical samples to Supabase\", e);\r\n         // 回退\r\n         const updatedCriticals = [...newCriticals, ...criticalSamples].slice(0, 50);\r\n         safeLocalStorageSet('nutrilens_critical_samples_v1', updatedCriticals, setCriticalSamples);\r\n       }\r\n    } else if (isManual) {\r\n       setManualMarkError(\"请先修改上方的重量数值，以便我们记录偏差。\");\r\n       setTimeout(() => setManualMarkError(null), 3500);\r\n    }\r\n  };\r\n\r\n  const manualSaveCritical = async () => {\r\n    if (currentScan) await processCriticalSamples(currentScan, true);\r\n  };\r\n\r\n  const confirmSaveStaple = async () => {\r\n    if (!currentScan || !stapleNameInput.trim()) return;\r\n    const newStaple: Omit<StapleMeal, 'id'> = {\r\n      name: stapleNameInput.trim(),\r\n      imageUrl: currentScan.imageUrl,\r\n      items: currentScan.items.map(({ id, ...rest }) => rest),\r\n      totalCalories: currentScan.items.reduce((acc, item) => acc + ((item.nutrients?.calories || 0) * (item.consumedPercentage / 100)), 0)\r\n    };\r\n    \r\n    try {\r\n      const savedStaple = await saveStapleToDb(newStaple);\r\n      setStaples(prev => [savedStaple, ...prev].slice(0, 20));\r\n      setIsSavingStaple(false);\r\n      setStapleNameInput('');\r\n      setShowStapleSuccess(true);\r\n      setTimeout(() => setShowStapleSuccess(false), 3000);\r\n    } catch (e) {\r\n      console.error(\"Failed to save staple to Supabase\", e);\r\n      // 回退到 localStorage\r\n      safeLocalStorageSet('nutrilens_staples_v1', [{ ...newStaple, id: Date.now().toString() }, ...staples].slice(0, 20), setStaples);\r\n    }\r\n  };\r\n\r\n  const logStaple = (staple: StapleMeal) => {\r\n    const newScan: FoodScan = {\r\n      id: Date.now().toString(),\r\n      timestamp: Date.now(),\r\n      imageUrl: staple.imageUrl,\r\n      description: `快速复用: ${staple.name}`,\r\n      insight: `已快速复用常餐“${staple.name}”。数据已根据您的模版自动填充。`,\r\n      globalScale: 100,\r\n      items: staple.items.map((it, idx) => ({\r\n        ...it,\r\n        id: `item-${idx}-${Date.now()}`,\r\n        consumedPercentage: 100\r\n      }))\r\n    };\r\n    setCurrentScan(newScan);\r\n    saveToHistory(newScan);\r\n    setState(AppState.RESULT);\r\n  };\r\n\r\n  const finishSession = async () => {\r\n    if (currentScan) await processCriticalSamples(currentScan, false);\r\n    reset();\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      setError(null);\r\n      setState(AppState.CAMERA);\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });\r\n      if (videoRef.current) videoRef.current.srcObject = stream;\r\n    } catch (err) {\r\n      setError('无法访问摄像头');\r\n      setState(AppState.IDLE);\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (videoRef.current?.srcObject) (videoRef.current.srcObject as MediaStream).getTracks().forEach(t => t.stop());\r\n  };\r\n\r\n  const captureImage = async () => {\r\n    if (!videoRef.current || !canvasRef.current) return;\r\n    const canvas = canvasRef.current;\r\n    canvas.width = 800;\r\n    canvas.height = (videoRef.current.videoHeight / videoRef.current.videoWidth) * 800;\r\n    canvas.getContext('2d')?.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\r\n    const base64 = canvas.toDataURL('image/jpeg', 0.6);\r\n    stopCamera();\r\n    prepareAnalysis(base64);\r\n  };\r\n\r\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onload = async (ev) => {\r\n        const compressed = await compressImage(ev.target?.result as string);\r\n        prepareAnalysis(compressed);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const prepareAnalysis = (imageUrl: string) => {\r\n    setTempImageUrl(imageUrl);\r\n    setIsConfirming(true);\r\n    setState(AppState.IDLE);\r\n    setHasSavedCritical(false);\r\n    setManualMarkError(null);\r\n  };\r\n\r\n  const runAnalysis = async () => {\r\n    if (!tempImageUrl) return;\r\n    setIsLoading(true);\r\n    setIsConfirming(false);\r\n    setState(AppState.ANALYZING);\r\n    try {\r\n      // 1. 先将图片上传到 Supabase Storage\r\n      const cloudImageUrl = await uploadImage(tempImageUrl);\r\n      \r\n      // 2. 使用 Base64 数据进行分析 (Gemini API 不接受 URL)\r\n      const result = await analyzeFoodImage(tempImageUrl, additionalContext, selectedModel);\r\n      \r\n      const newScan: FoodScan = {\r\n        id: Date.now().toString(),\r\n        timestamp: Date.now(),\r\n        imageUrl: cloudImageUrl, // 但保存到历史记录时使用云端 URL\r\n        description: result.description,\r\n        insight: result.insight,\r\n        globalScale: 100,\r\n        items: result.items.map((it, idx) => ({\r\n          ...it,\r\n          id: `item-${idx}-${Date.now()}`,\r\n          consumedPercentage: 100\r\n        }))\r\n      };\r\n      setCurrentScan(newScan);\r\n      await saveToHistory(newScan);\r\n      setState(AppState.RESULT);\r\n    } catch (err: any) {\r\n      setError(err.message || '分析失败');\r\n      setState(AppState.IDLE);\r\n    } finally {\r\n      setIsLoading(false);\r\n      setAdditionalContext('');\r\n      setTempImageUrl(null);\r\n    }\r\n  };\r\n\r\n  const startVoiceInput = () => {\r\n    if (!SpeechRecognition) return alert(\"不支持语音识别\");\r\n    const recognition = new SpeechRecognition();\r\n    recognition.lang = 'zh-CN'; \r\n    recognition.onstart = () => setIsListening(true);\r\n    recognition.onend = () => setIsListening(false);\r\n    recognition.onresult = (event: any) => setAdditionalContext(prev => (prev ? prev + ' ' : '') + event.results[0][0].transcript);\r\n    recognition.start();\r\n  };\r\n\r\n  const updateItemScale = (itemId: string, percentage: number) => {\r\n    if (!currentScan) return;\r\n    const updatedItems = currentScan.items.map(item => item.id === itemId ? { ...item, consumedPercentage: percentage } : item);\r\n    const totalOriginalWeight = updatedItems.reduce((sum, item) => sum + item.estimatedWeightGrams, 0);\r\n    const totalConsumedWeight = updatedItems.reduce((sum, item) => sum + (item.estimatedWeightGrams * (item.consumedPercentage / 100)), 0);\r\n    setCurrentScan({ ...currentScan, items: updatedItems, globalScale: totalOriginalWeight > 0 ? Math.round((totalConsumedWeight / totalOriginalWeight) * 100) : percentage });\r\n  };\r\n\r\n  const renameItem = (itemId: string, newName: string) => {\r\n    if (!currentScan) return;\r\n    setCurrentScan({ ...currentScan, items: currentScan.items.map(item => item.id === itemId ? { ...item, name: newName } : item) });\r\n  };\r\n\r\n  const updateItemWeight = (itemId: string, newWeight: number) => {\r\n    if (!currentScan || isNaN(newWeight)) return;\r\n    setCurrentScan({ ...currentScan, items: currentScan.items.map(item => item.id === itemId ? { ...item, estimatedWeightGrams: newWeight } : item) });\r\n  };\r\n  \r\n  const nudgeItemWeight = (itemId: string, factor: number) => {\r\n    if (!currentScan) return;\r\n    const item = currentScan.items.find(i => i.id === itemId);\r\n    if (item) updateItemWeight(itemId, Math.max(1, Math.round(item.estimatedWeightGrams * factor)));\r\n  };\r\n\r\n  const totals = useMemo(() => {\r\n    if (!currentScan) return { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, sugar: 0, weight: 0 };\r\n    return currentScan.items.reduce((acc, item) => {\r\n      const factor = (item.consumedPercentage || 0) / 100;\r\n      const n = (item.nutrients || {}) as any;\r\n      return {\r\n        calories: acc.calories + ((n.calories || 0) * factor),\r\n        protein: acc.protein + ((n.protein || 0) * factor),\r\n        carbs: acc.carbs + ((n.carbs || 0) * factor),\r\n        fat: acc.fat + ((n.fat || 0) * factor),\r\n        fiber: acc.fiber + ((n.fiber || 0) * factor),\r\n        sugar: acc.sugar + ((n.sugar || 0) * factor),\r\n        weight: acc.weight + ((item.estimatedWeightGrams || 0) * factor)\r\n      };\r\n    }, { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, sugar: 0, weight: 0 });\r\n  }, [currentScan]);\r\n\r\n  const updateWeightByTotal = (newTotal: number) => {\r\n    if (!currentScan || isNaN(newTotal) || newTotal <= 0) return;\r\n    const currentTotal = currentScan.items.reduce((sum, item) => sum + item.estimatedWeightGrams, 0);\r\n    if (currentTotal === 0) return;\r\n    const ratio = newTotal / currentTotal;\r\n    setCurrentScan({ ...currentScan, items: currentScan.items.map(item => ({ ...item, estimatedWeightGrams: Math.round(item.estimatedWeightGrams * ratio) })) });\r\n  };\r\n\r\n  const reset = () => {\r\n    stopCamera();\r\n    setCurrentScan(null);\r\n    setState(AppState.IDLE);\r\n    setIsConfirming(false);\r\n    setIsSavingStaple(false);\r\n    setError(null);\r\n    setExpandedItemId(null);\r\n    setHasSavedCritical(false);\r\n    setManualMarkError(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 text-gray-900 pb-20\">\r\n      <input type=\"file\" ref={fileInputRef} onChange={handleFileUpload} accept=\"image/*\" className=\"hidden\" />\r\n      \r\n      <header className=\"fixed top-0 inset-x-0 bg-white/80 backdrop-blur-md z-40 px-6 py-4 flex items-center justify-between border-b border-gray-100 shadow-sm\">\r\n        <h1 className=\"text-xl font-extrabold bg-gradient-to-r from-green-600 to-emerald-500 bg-clip-text text-transparent\">NutriLens 智能食探</h1>\r\n        <div className=\"flex items-center gap-4\">\r\n          {(state !== AppState.IDLE || isConfirming) && <button onClick={reset} className=\"text-gray-400 hover:text-gray-600 p-2\"><Icons.XCircle /></button>}\r\n        </div>\r\n      </header>\r\n\r\n      {capturedCriticals > 0 && (\r\n         <div className=\"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-red-500 text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-2 animate-in slide-in-from-top-4 whitespace-nowrap\">\r\n            <Icons.Warn />\r\n            <span className=\"text-sm font-bold\">{criticalToastMessage}</span>\r\n         </div>\r\n      )}\r\n\r\n      <main className=\"pt-24 px-4 max-w-lg mx-auto\">\r\n        {state === AppState.IDLE && !isConfirming && (\r\n          <div className=\"space-y-8 py-6 animate-in fade-in\">\r\n            {error && <div className=\"bg-red-50 border border-red-100 text-red-500 px-4 py-3 rounded-2xl flex items-center gap-3 text-sm font-bold animate-in slide-in-from-top-2\"><Icons.Warn />{error}</div>}\r\n            \r\n            <div className=\"bg-white p-1 rounded-2xl flex items-center shadow-sm border border-gray-100 mx-auto w-fit\">\r\n              <button onClick={() => setSelectedModel(MODELS.FLASH)} className={`px-4 py-2 rounded-xl text-xs font-black transition-all ${selectedModel === MODELS.FLASH ? 'bg-gray-900 text-white' : 'text-gray-400 hover:text-gray-600'}`}>快速版</button>\r\n              <button onClick={() => setSelectedModel(MODELS.PRO)} className={`px-4 py-2 rounded-xl text-xs font-black transition-all ${selectedModel === MODELS.PRO ? 'bg-green-600 text-white' : 'text-gray-400 hover:text-gray-600'}`}>精细版</button>\r\n            </div>\r\n\r\n            <div className=\"text-center space-y-2\">\r\n              <h2 className=\"text-4xl font-black text-gray-800 tracking-tight\">智能识餐。</h2>\r\n              <p className=\"text-gray-500 font-medium px-4\">口袋里的 AI 食物秤，精准分析每一口营养。</p>\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 gap-6\">\r\n              <button onClick={startCamera} className=\"w-full bg-green-600 text-white rounded-[2.5rem] p-8 flex flex-col items-center gap-3 shadow-2xl shadow-green-100 transition-transform active:scale-95 group relative overflow-hidden\">\r\n                <div className=\"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity\"></div>\r\n                <div className=\"p-4 bg-white/20 rounded-full\"><Icons.Camera /></div>\r\n                <span className=\"text-xl font-bold\">立即拍照识别</span>\r\n              </button>\r\n\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between px-1\">\r\n                  <h3 className=\"text-xs font-black text-gray-400 uppercase tracking-widest flex items-center gap-2\">我的常用餐食 <Icons.Heart fill=\"currentColor\" /></h3>\r\n                  {staples.length > 0 && <span className=\"text-[10px] text-green-600 font-bold\">左右滑动快速记录</span>}\r\n                </div>\r\n                <div className=\"flex gap-4 overflow-x-auto pb-4 no-scrollbar -mx-4 px-4\">\r\n                  {staples.length > 0 ? staples.map(staple => (\r\n                      <button key={staple.id} onClick={() => logStaple(staple)} className=\"flex-shrink-0 w-28 space-y-2 text-left group\">\r\n                        <div className=\"relative aspect-square rounded-[1.5rem] overflow-hidden border-2 border-transparent group-hover:border-green-500 shadow-sm transition-all group-active:scale-90\">\r\n                          <img src={staple.imageUrl} className=\"w-full h-full object-cover\" />\r\n                          <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent\"></div>\r\n                          <div className=\"absolute bottom-2 left-2 right-2 text-[10px] font-black text-white truncate\">{staple.name}</div>\r\n                        </div>\r\n                      </button>\r\n                    )) : (\r\n                    <div className=\"w-full bg-gray-100/50 border-2 border-dashed border-gray-200 rounded-[2rem] p-6 flex flex-col items-center justify-center text-center space-y-2 text-gray-400 italic\">\r\n                      <div className=\"p-3 bg-white rounded-full text-gray-300\"><Icons.Heart /></div>\r\n                      <p className=\"text-xs font-medium\">识别后点击爱心保存常餐<br/>下次吃饭一键复用，无需重拍</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <button onClick={() => fileInputRef.current?.click()} className=\"bg-white border border-gray-100 rounded-[1.5rem] p-4 flex flex-col items-center gap-2 shadow-sm active:scale-95 transition-transform\">\r\n                  <div className=\"p-2 bg-gray-50 rounded-full text-gray-400\"><Icons.Upload /></div>\r\n                  <span className=\"text-xs font-bold text-gray-600\">从相册上传</span>\r\n                </button>\r\n                <button onClick={() => setState(AppState.HISTORY)} className=\"bg-white border border-gray-100 rounded-[1.5rem] p-4 flex flex-col items-center gap-2 shadow-sm active:scale-95 transition-transform\">\r\n                  <div className=\"p-2 bg-gray-50 rounded-full text-gray-400\"><Icons.History /></div>\r\n                  <span className=\"text-xs font-bold text-gray-600\">查看历史</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {isConfirming && tempImageUrl && (\r\n          <div className=\"animate-in slide-in-from-bottom-10 space-y-6 pb-32\">\r\n            <div className=\"relative rounded-3xl overflow-hidden shadow-xl\">\r\n              <img src={tempImageUrl} className=\"w-full aspect-video object-cover\" />\r\n              <div className=\"absolute top-4 right-4 bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-full text-[10px] font-black text-white uppercase tracking-widest\">{selectedModel === MODELS.PRO ? '精细模式' : '快速模式'}</div>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-center gap-2\"><div className=\"p-2 bg-blue-100 text-blue-600 rounded-lg\"><Icons.Sparkles /></div><h3 className=\"text-xl font-black text-gray-800\">补充细节</h3></div>\r\n              <p className=\"text-sm text-gray-500 leading-relaxed\">提供更多上下文能显著提高识别准确率（如：这是我的 500ml 标准便当盒）。</p>\r\n              <div className=\"relative\">\r\n                <textarea value={additionalContext} onChange={(e) => setAdditionalContext(e.target.value)} placeholder=\"例如：这是学校食堂的大份，或者额外加了辣油...\" className=\"w-full bg-white border border-gray-200 rounded-2xl p-4 pr-12 min-h-[120px] text-gray-700 focus:ring-2 focus:ring-green-500 outline-none transition-shadow text-base\" />\r\n                <button onClick={startVoiceInput} className={`absolute right-3 bottom-3 p-3 rounded-full transition-all ${isListening ? 'bg-red-500 text-white animate-pulse shadow-lg shadow-red-100' : 'bg-gray-50 text-gray-400 hover:text-green-600'}`}><Icons.Microphone /></button>\r\n              </div>\r\n              <button onClick={runAnalysis} className=\"w-full bg-gray-900 text-white rounded-2xl py-5 font-bold shadow-2xl active:scale-95 transition-all text-lg\">{isLoading ? '正在深度分析...' : '确认并开始分析'}</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {state === AppState.CAMERA && (\r\n          <div className=\"fixed inset-0 bg-black z-50 flex flex-col\">\r\n            <video ref={videoRef} autoPlay playsInline className=\"flex-1 object-cover\" />\r\n            <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center\">\r\n              <div className=\"w-72 h-72 border-2 border-white/20 rounded-[3rem] relative\">\r\n                <div className=\"absolute -top-1 -left-1 w-10 h-10 border-t-4 border-l-4 border-green-500 rounded-tl-[1.5rem]\"></div>\r\n                <div className=\"absolute -top-1 -right-1 w-10 h-10 border-t-4 border-r-4 border-green-500 rounded-tr-[1.5rem]\"></div>\r\n                <div className=\"absolute -bottom-1 -left-1 w-10 h-10 border-b-4 border-l-4 border-green-500 rounded-bl-[1.5rem]\"></div>\r\n                <div className=\"absolute -bottom-1 -right-1 w-10 h-10 border-b-4 border-r-4 border-green-500 rounded-br-[1.5rem]\"></div>\r\n              </div>\r\n            </div>\r\n            <div className=\"absolute top-20 inset-x-4\"><div className=\"bg-black/40 backdrop-blur-md border border-white/10 rounded-2xl p-4 flex items-center gap-3 text-white\"><div className=\"text-green-400 shrink-0\">{CAMERA_TIPS[currentTipIndex].icon}</div><p className=\"text-sm font-medium\">{CAMERA_TIPS[currentTipIndex].text}</p></div></div>\r\n            <div className=\"absolute bottom-12 inset-x-0 flex items-center justify-center gap-8 px-10\">\r\n              <button onClick={reset} className=\"p-4 bg-white/10 backdrop-blur-md rounded-full text-white active:scale-90 transition-transform\"><Icons.ArrowLeft /></button>\r\n              <div className=\"relative\"><button onClick={captureImage} className=\"w-20 h-20 bg-white rounded-full border-8 border-white/30 active:scale-90 transition-transform flex items-center justify-center relative z-10\" /><div className=\"absolute -inset-2 bg-green-500/20 rounded-full animate-ping pointer-events-none\"></div></div>\r\n              <button onClick={() => fileInputRef.current?.click()} className=\"p-4 bg-white/10 backdrop-blur-md rounded-full text-white active:scale-90 transition-transform\"><Icons.Upload /></button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {state === AppState.ANALYZING && (\r\n          <div className=\"fixed inset-0 bg-white z-50 flex flex-col items-center justify-center text-center p-8 space-y-6\">\r\n            <div className=\"w-24 h-24 relative\"><div className=\"absolute inset-0 border-4 border-green-100 rounded-full\"></div><div className=\"absolute inset-0 border-4 border-green-600 rounded-full border-t-transparent animate-spin\"></div><div className=\"absolute inset-0 flex items-center justify-center text-green-600\"><Icons.Sparkles /></div></div>\r\n            <div className=\"space-y-2\"><h3 className=\"text-2xl font-black text-gray-800 tracking-tight\">AI 视觉扫描中...</h3><p className=\"text-green-600 text-[10px] font-black uppercase tracking-[0.2em] mb-4\">正在通过 {selectedModel === MODELS.PRO ? '精细版模型' : '快速版模型'} 分析</p>\r\n               <div className=\"bg-green-50/50 p-4 rounded-2xl max-w-[280px] mx-auto animate-in fade-in slide-in-from-bottom-2\"><p className=\"text-green-800 text-xs font-bold mb-1\">💡 健康冷知识</p><p className=\"text-green-600 text-sm font-medium leading-relaxed\">{HEALTH_TIPS[currentHealthTip]}</p></div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {state === AppState.RESULT && currentScan && (\r\n          <div className=\"animate-in slide-in-from-bottom-10 space-y-8 pb-32\">\r\n            <div className=\"relative rounded-[2.5rem] overflow-hidden shadow-2xl border border-white\">\r\n              <img src={currentScan.imageUrl} className=\"w-full aspect-square object-cover\" />\r\n              <div className=\"absolute bottom-4 left-4 right-4 bg-white/90 backdrop-blur-md p-4 rounded-[1.5rem] shadow-lg border border-white/50\"><div className=\"flex items-center gap-2 text-green-600 mb-1\"><Icons.Sparkles /><span className=\"text-[10px] font-black uppercase tracking-widest\">AI 健康透视</span></div><p className=\"text-xs text-gray-700 font-semibold leading-relaxed\">\"{currentScan.insight}\"</p></div>\r\n              <button onClick={() => setIsSavingStaple(true)} className={`absolute top-4 right-4 p-4 rounded-full backdrop-blur-md transition-all transform hover:scale-110 active:scale-90 shadow-lg ${showStapleSuccess ? 'bg-green-500 text-white' : 'bg-black/30 text-white'}`}>{showStapleSuccess ? <Icons.Check /> : <Icons.Heart fill={staples.some(s => s.imageUrl === currentScan.imageUrl) ? \"currentColor\" : \"none\"} />}</button>\r\n            </div>\r\n\r\n            {showStapleSuccess && <div className=\"bg-green-600 text-white px-5 py-4 rounded-2xl text-xs font-black animate-in slide-in-from-top-4 flex items-center gap-3 shadow-xl shadow-green-100\"><Icons.Check /> 已成功保存到常餐模版，下次可在首页快速复用。</div>}\r\n\r\n            <div className=\"space-y-6\">\r\n              <div className=\"flex items-center justify-between px-1\"><h2 className=\"text-2xl font-black text-gray-800 tracking-tight\">营养统计</h2><div className=\"text-right\"><span className=\"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1\">总预估重量</span><div className=\"flex items-center gap-2 bg-green-50 px-4 py-1.5 rounded-full border border-green-100\"><input type=\"number\" value={Math.round(totals.weight)} onChange={(e) => updateWeightByTotal(parseInt(e.target.value))} className=\"bg-transparent text-lg font-black text-green-600 w-16 text-right focus:outline-none border-none p-0\" /><span className=\"text-green-600 font-bold text-sm\">克</span><div className=\"text-green-300 ml-1\"><Icons.Angle /></div></div></div></div>\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <NutrientBadge label=\"热量\" value={totals.calories} unit=\"kcal\" color=\"bg-orange-500\" icon={<Icons.Calories />} />\r\n                <NutrientBadge label=\"蛋白质\" value={totals.protein} unit=\"g\" color=\"bg-blue-600\" icon={<Icons.Protein />} />\r\n                <NutrientBadge label=\"总碳水\" value={totals.carbs} unit=\"g\" color=\"bg-yellow-500\" icon={<Icons.Carbs />} />\r\n                <NutrientBadge label=\"总脂肪\" value={totals.fat} unit=\"g\" color=\"bg-red-500\" icon={<Icons.Fat />} />\r\n              </div>\r\n\r\n              <div className=\"space-y-4 pt-4\"><h3 className=\"text-xs font-black text-gray-400 uppercase tracking-widest px-1\">包含成分 ({currentScan.items.length})</h3>\r\n                <div className=\"space-y-3\">{currentScan.items.map((item) => {\r\n                    const isExpanded = expandedItemId === item.id;\r\n                    const factor = item.consumedPercentage / 100;\r\n                    const n = item.nutrients || { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0 };\r\n                    return (\r\n                      <div key={item.id} className=\"bg-white overflow-hidden rounded-[1.5rem] border border-gray-100 shadow-sm transition-all duration-300\">\r\n                        <div className=\"p-5 space-y-4\"><div className=\"flex items-start justify-between\"><div className=\"flex-1 pr-4\"><input value={item.name} onChange={(e) => renameItem(item.id, e.target.value)} className=\"font-black text-gray-800 leading-tight bg-transparent border-none focus:ring-0 p-0 w-full text-base\" />\r\n                              <div className=\"flex items-center gap-3 mt-2\"><div className=\"flex items-center gap-1 px-2 py-1 rounded-lg bg-gray-50 border border-gray-100 focus-within:border-green-300 focus-within:ring-2 focus-within:ring-green-100 transition-all\"><input type=\"number\" value={Math.round(item.estimatedWeightGrams)} onChange={(e) => updateItemWeight(item.id, parseInt(e.target.value))} className=\"w-10 bg-transparent font-bold text-gray-600 focus:outline-none border-none p-0 text-center\" /><span className=\"text-gray-400 font-medium text-xs\">g</span></div>\r\n                                <div className=\"flex items-center gap-1\"><button onClick={() => nudgeItemWeight(item.id, 0.9)} className=\"p-1.5 rounded-full bg-red-50 text-red-500 hover:bg-red-100 active:scale-90 transition-all\"><Icons.Minus /></button><button onClick={() => nudgeItemWeight(item.id, 1.1)} className=\"p-1.5 rounded-full bg-green-50 text-green-600 hover:bg-green-100 active:scale-90 transition-all\"><Icons.Plus /></button></div><span className=\"text-[10px] text-gray-300\">|</span><span className=\"text-xs text-gray-400\">摄入: <strong className=\"text-gray-700\">{Math.round(item.estimatedWeightGrams * factor)}g</strong></span></div></div>\r\n                            <div className=\"text-right flex flex-col items-end\"><span className=\"block text-green-600 font-black whitespace-nowrap\">{Math.round((n.calories || 0) * factor)} kcal</span><button onClick={() => setExpandedItemId(isExpanded ? null : item.id)} className=\"text-gray-300 hover:text-gray-500 p-1\">{isExpanded ? <Icons.ChevronUp /> : <Icons.ChevronDown />}</button></div></div>\r\n                          <div className=\"space-y-2\"><div className=\"flex justify-between text-[10px] font-black text-gray-400 uppercase\"><span>摄入比例</span><span>{item.consumedPercentage}%</span></div><input type=\"range\" min=\"0\" max=\"100\" value={item.consumedPercentage} onChange={(e) => updateItemScale(item.id, parseInt(e.target.value))} className=\"w-full h-2 bg-gray-50 rounded-lg appearance-none cursor-pointer accent-green-500\" /></div></div>\r\n                        {isExpanded && (<div className=\"px-5 pb-5 pt-0 animate-in fade-in slide-in-from-top-1\"><div className=\"border-t border-gray-50 pt-4 grid grid-cols-2 gap-2\"><div className=\"bg-gray-50/50 p-2 rounded-xl flex justify-between items-center\"><span className=\"text-[10px] font-bold text-gray-400\">蛋白质</span><span className=\"text-xs font-black\">{((n.protein || 0) * factor).toFixed(1)}g</span></div><div className=\"bg-gray-50/50 p-2 rounded-xl flex justify-between items-center\"><span className=\"text-[10px] font-bold text-gray-400\">碳水</span><span className=\"text-xs font-black\">{((n.carbs || 0) * factor).toFixed(1)}g</span></div><div className=\"bg-gray-50/50 p-2 rounded-xl flex justify-between items-center\"><span className=\"text-[10px] font-bold text-gray-400\">脂肪</span><span className=\"text-xs font-black\">{((n.fat || 0) * factor).toFixed(1)}g</span></div><div className=\"bg-gray-50/50 p-2 rounded-xl flex justify-between items-center\"><span className=\"text-[10px] font-bold text-gray-400\">纤维</span><span className=\"text-xs font-black\">{((n.fiber || 0) * factor).toFixed(1)}g</span></div></div></div>)}\r\n                      </div>\r\n                    );\r\n                  })}</div>\r\n              </div>\r\n              <div className=\"space-y-3 mt-4\"><button onClick={finishSession} className=\"w-full bg-gray-900 text-white rounded-[1.5rem] py-5 font-black shadow-xl active:scale-95 transition-all text-lg\">确认记录并完成</button>\r\n                <div className=\"relative\">{manualMarkError && (<div className=\"absolute bottom-full left-0 right-0 mb-2 text-center animate-in slide-in-from-bottom-2 fade-in\"><span className=\"inline-block bg-red-600 text-white text-[10px] font-bold px-3 py-1.5 rounded-lg shadow-lg relative\">{manualMarkError}<div className=\"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-red-600\"></div></span></div>)}\r\n                   <button onClick={manualSaveCritical} disabled={hasSavedCritical} className={`w-full py-3 text-xs font-bold flex items-center justify-center gap-1 transition-all active:scale-95 ${hasSavedCritical ? 'text-green-500 bg-green-50 rounded-xl cursor-default' : 'text-red-400 hover:text-red-500 hover:bg-red-50 rounded-xl'}`}>{hasSavedCritical ? (<><Icons.Check /> 已标记为偏差样本</>) : (<><Icons.Warn /> 认为 AI 估算偏差大？点击标记样本</>)}</button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {isSavingStaple && (\r\n          <div className=\"fixed inset-0 z-[100] flex items-end justify-center px-4 pb-10 bg-black/60 backdrop-blur-sm animate-in fade-in\">\r\n             <div className=\"w-full max-w-sm bg-white rounded-[2.5rem] p-8 space-y-6 shadow-2xl animate-in slide-in-from-bottom-10\"><div className=\"space-y-2 text-center\"><div className=\"w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4\"><Icons.Heart fill=\"currentColor\" /></div><h3 className=\"text-2xl font-black text-gray-800\">存为常餐模版</h3><p className=\"text-sm text-gray-500\">下次吃同样的食物，一键复用模版比例，无需再次拍摄。</p></div>\r\n                <div className=\"space-y-2\"><label className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest px-1\">餐食名称</label><input autoFocus value={stapleNameInput} onChange={(e) => setStapleNameInput(e.target.value)} placeholder=\"例如：公司食堂鸡肉丸套餐...\" className=\"w-full bg-gray-50 border-none rounded-2xl p-5 text-lg font-bold text-gray-800 focus:ring-2 focus:ring-green-500 outline-none\" /></div>\r\n                <div className=\"grid grid-cols-2 gap-3 pt-2\"><button onClick={() => setIsSavingStaple(false)} className=\"py-4 rounded-2xl font-bold text-gray-400 hover:bg-gray-50\">取消</button><button onClick={confirmSaveStaple} className=\"py-4 bg-green-600 text-white rounded-2xl font-black shadow-lg shadow-green-100 active:scale-95 transition-transform\">确认保存</button></div>\r\n             </div>\r\n          </div>\r\n        )}\r\n\r\n        {state === AppState.HISTORY && (\r\n          <div className=\"animate-in slide-in-from-bottom-10 space-y-6 pb-20\"><div className=\"flex items-center gap-4\"><button onClick={() => setState(AppState.IDLE)} className=\"p-3 bg-white rounded-full text-gray-400 shadow-sm\"><Icons.ArrowLeft /></button><h2 className=\"text-2xl font-black text-gray-800\">历史记录</h2></div>\r\n             <button onClick={() => setState(AppState.CRITICAL_SAMPLES)} className=\"w-full bg-red-50 border border-red-100 rounded-[1.5rem] p-4 flex items-center justify-between shadow-sm active:scale-95 transition-transform\"><div className=\"flex items-center gap-3\"><div className=\"p-2 bg-red-100 text-red-600 rounded-full\"><Icons.Warn /></div><div className=\"text-left\"><p className=\"text-sm font-bold text-red-800\">偏差样本库</p><p className=\"text-xs text-red-400\">已归档 {criticalSamples.length} 个 AI 偏差案例</p></div></div><div className=\"text-red-300\"><Icons.ChevronDown /></div></button>\r\n             <div className=\"space-y-4\">{history.length > 0 ? history.map(h => (<div key={h.id} onClick={() => { setCurrentScan(h); setState(AppState.RESULT); }} className=\"bg-white rounded-[1.5rem] p-4 flex items-center gap-4 border border-gray-100 shadow-sm cursor-pointer hover:border-green-500 transition-colors\"><img src={h.imageUrl} className=\"w-16 h-16 rounded-xl object-cover\" /><div className=\"flex-1\"><p className=\"text-sm font-black text-gray-800 line-clamp-1\">{h.description}</p><p className=\"text-xs text-gray-400 mt-1\">{new Date(h.timestamp).toLocaleDateString()} • {Math.round(h.items.reduce((acc, i) => acc + (i.nutrients?.calories || 0), 0))} kcal</p></div></div>)) : (<div className=\"py-20 text-center space-y-2 text-gray-300 italic\"><Icons.History /><p>暂无识别历史</p></div>)}</div>\r\n          </div>\r\n        )}\r\n\r\n        {state === AppState.CRITICAL_SAMPLES && (\r\n           <div className=\"animate-in slide-in-from-bottom-10 space-y-6 pb-20\"><div className=\"flex items-center gap-4\"><button onClick={() => setState(AppState.HISTORY)} className=\"p-3 bg-white rounded-full text-gray-400 shadow-sm\"><Icons.ArrowLeft /></button><h2 className=\"text-xl font-black text-gray-800\">AI 偏差样本库</h2></div><p className=\"text-sm text-gray-500 px-1\">当您对 AI 的估算结果修正超过 30% 时，系统会自动将该样本保存至此，以便后续分析。</p>\r\n             <div className=\"space-y-4\">{criticalSamples.length > 0 ? criticalSamples.map(sample => (<div key={sample.id} className=\"bg-white rounded-[1.5rem] p-4 border border-red-100 shadow-sm space-y-3\"><div className=\"flex gap-4\"><img src={sample.imageUrl} className=\"w-20 h-20 rounded-xl object-cover\" /><div className=\"flex-1 space-y-1\"><p className=\"text-sm font-black text-gray-800\">{sample.foodName}</p><p className=\"text-xs text-gray-400\">{new Date(sample.timestamp).toLocaleDateString()}</p><div className=\"inline-block px-2 py-1 bg-red-100 text-red-600 rounded-lg text-[10px] font-bold mt-1\">偏差 {sample.deviationPercent > 0 ? '+' : ''}{sample.deviationPercent}%</div></div></div><div className=\"bg-gray-50 rounded-xl p-3 flex justify-between items-center text-xs\"><div className=\"text-center\"><p className=\"text-gray-400 mb-1\">AI 预估</p><p className=\"font-black text-gray-800 text-lg\">{Math.round(sample.aiWeight)}g</p></div><div className=\"text-gray-300\">➔</div><div className=\"text-center\"><p className=\"text-gray-400 mb-1\">您修正为</p><p className=\"font-black text-green-600 text-lg\">{Math.round(sample.userWeight)}g</p></div></div></div>)) : (<div className=\"py-20 text-center space-y-2 text-gray-300 italic\"><Icons.Check /><p>暂无严重偏差样本<br/>说明 AI 最近表现不错！</p></div>)}</div>\r\n           </div>\r\n        )}\r\n      </main>\r\n\r\n      <canvas ref={canvasRef} className=\"hidden\" />\r\n\r\n      {(state === AppState.IDLE || state === AppState.HISTORY || state === AppState.CRITICAL_SAMPLES) && (\r\n        <nav className=\"fixed bottom-8 inset-x-0 w-[85%] max-w-sm mx-auto bg-gray-900/90 backdrop-blur-xl border border-white/10 shadow-2xl rounded-[3rem] px-8 py-4 flex items-center justify-around z-40\">\r\n          <button onClick={() => setState(AppState.IDLE)} className={`p-2 transition-all ${state === AppState.IDLE ? 'text-green-500' : 'text-white/50'}`}><Icons.Sparkles /></button>\r\n          <button onClick={startCamera} className=\"w-16 h-16 bg-green-500 text-white rounded-full -mt-16 border-[6px] border-gray-900 shadow-xl flex items-center justify-center active:scale-90 transition-transform\"><Icons.Camera /></button>\r\n          <button onClick={() => setState(AppState.HISTORY)} className={`p-2 transition-all ${state === AppState.HISTORY || state === AppState.CRITICAL_SAMPLES ? 'text-green-500' : 'text-white/50'}`}><Icons.History /></button>\r\n        </nav>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}